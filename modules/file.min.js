var fs=require("fs"),path=require("path"),mysql=require("../modules/mysql.js");exports.getMain=function(b,a){a.sendFile(path.normalize(__dirname+"/../public/main.html"),function(c){if(c){console.log(c);console.log("读取页面错误")}})};exports.createSmPic=function(g,b){var c=g,b=b;for(var e in c){var f=path.normalize(__dirname+"/../baseurl/")+b+"-"+e,g=c[e],d=new Buffer(g,"base64");fs.writeFile(f,d,function(a){if(a){console.log("创建图片失败！")}})}};exports.readText=function(a,c){var b=path.normalize(__dirname+"/../baseurl")+a;fs.readFile(b,function(e,f){if(e){console.log("读取文件失败！"+e)}else{var g=f.toString();if(c){c(g)}}})};exports.modifyImgSrc=function(a,h,e,d){var g=path.normalize(__dirname+"/../uploads")+a,b=path.normalize(__dirname+"/../uploads")+h,f=path.normalize(__dirname+"/../baseurl")+e,c=path.normalize(__dirname+"/../baseurl")+d;fs.exists(g,function(i){if(i){fs.rename(g,b,function(j){if(j){console.log("更改名字失败！")}})}});fs.exists(f,function(i){if(i){fs.rename(f,c,function(j){if(j){console.log("更改名字失败！")}})}})};exports.deleteImgSrc=function(a,b,c){deletePic(a,b,c)};exports.deleteAllImgSrc=function(c,f){var e=c,a=e.length;(function b(d){if(d==a){if(f){f()}return}deletePic(e[d].url,e[d].baseUrl);b(++d)})(0)};function deletePic(a,b,c){var a=path.normalize(__dirname+"/../uploads")+a,b=path.normalize(__dirname+"/../baseurl")+b;fs.exists(a,function(d){if(d){fs.unlink(a,function(e){if(e){console.log("删除文件失败！")}else{if(c){c()}fs.exists(b,function(f){if(f){fs.unlink(b,function(g){if(g){console.log("删除文件失败！")}})}})}})}})};